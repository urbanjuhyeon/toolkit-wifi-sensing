# Flexurba: An open-source R package to flexibly reconstruct the Degree of Urbanisation classification

Urban Data/Code

EPB: Urban Analytics and City Science
2024, Vol. 0(0) 1–9
© The Author(s) 2024

DOI: 10.1177/23998083241262545

**Céline Van Migerode**
KU Leuven, Belgium

**Ate Poorthuis**
KU Leuven, Belgium

**Ben Derudder**
KU Leuven, Belgium; Ghent University, Belgium

## Abstract

This paper describes flexurba, a software library written in R, with the first open reconstruction of the Degree of Urbanisation algorithm to classify cities, towns, and rural areas. The R package offers enhanced flexibility and facilitates constructing alternative versions of the Degree of Urbanisation classification by customising parameters such as the minimum population size required for a city, and more 'hidden' implementation details including the contiguity rules and edge smoothing procedures. To illustrate how the package can be employed, we briefly demonstrate the grid classification and spatial units classification for Belgium. In addition, we compare results generated by the flexurba package with the official classification and discuss potential use cases. The package enables a broad range of analyses beyond the Degree of Urbanisation's original application, including evaluating alternative urban delineations, sensitivity analyses, and comparative research.

**Keywords**
Degree of urbanisation, R package, city delineation

**Corresponding author:**
Céline Van Migerode, Public Governance Institute / Division of Geography and Tourism, KU Leuven, Oude Markt 13, Leuven 3000, Belgium.
Email: celine.vanmigerode@kuleuven.be

Data Availability Statement included at the end of the article

---

## Introduction

The Degree of Urbanisation (DEGURBA) is an operational definition of cities, towns, and rural areas that is widely used in policy reports (Eurostat, 2016; Melchiorri et al., 2019; OECD, 2020) and academic circles alike (Dorward and Fox, 2022; Moreno-Monroy et al., 2021; Thornton et al., 2022). It is developed by six international organisations – including the OECD and the European Commission – to provide a globally consistent delineation of urban areas and thus enhance statistical comparability across nations (Dijkstra et al., 2021). Much effort has been devoted to making the workflow underlying DEGURBA's methodology as transparent and reproducible as possible: it is extensively documented in a manual (Eurostat, 2021) and a set of analytical tools is provided by the Global Human Settlement Layer (GHSL, 2023) to reproduce the classification. The current suite of tools employs a graphical user interface. This certainly enhances the ease of use, but also obscures the underlying code and restricts the user from adapting implementation details in the algorithm. Consequently, it complicates extending or amending the methodology to facilitate other, related uses. Furthermore, it inhibits research drawing on DEGURBA beyond its direct application, such as sensitivity analyses and/or comparative research. Open-source DEGURBA tools in popular programming languages such as R or Python would address these constraints and help further expand research with and on the Degree of Urbanisation.

Against this backdrop, we reconstructed the classification algorithm in R and openly published the code as the flexurba package: a **flex**ible reconstruction of the DEG**URBA** algorithm. The package seamlessly complements the already-rich set of existing tools and further improves the overall usability of the methodology. The contribution of the package is fourfold. First, the package encompasses the first open implementation of DEGURBA's algorithm in any programming language. In this way, we contribute to open science and respond to Boeing's (2020) recent call for open-source spatial research software. Second, as the package is written in R – a comprehensive and flexible environment increasingly employed in geospatial research – it facilitates incorporating DEGURBA in other common spatial analytical workflows. Third, the package provides flexibility to customise the parameters in the algorithm and thus evaluate the consequences of certain implementation choices. The user can construct alternative versions of DEGURBA by changing the minimum population thresholds and more 'hidden' implementation details, such as the contiguity rules and edge smoothing procedures. Fourth, two different versions of the DEGURBA algorithm are included in the package: the version of GHSL Data Package 2022 (Schiavina et al., 2022) and the version of GHSL Data Package 2023 (European Commission, 2023). Consequently, the package allows a comparison of differences between the versions and assessing the effect of changing implementation details.

The remainder of this paper describes the functionalities of the flexurba package and its possible applications. We begin by summarising the principles behind the DEGURBA methodology, followed by an illustration of the package's main functionalities. We then compare results with the official classification, after which we discuss computational requirements and potential use cases.

---

## The DEGURBA methodology

DEGURBA consists of two consecutive stages. In stage 1, the cells of a 1 km² population grid are classified into three different categories based on the following rules, detailed in the GHSL Data Package 2023 (European Commission, 2023):

- **Urban centres** are clusters of cells (rook contiguity) with a minimum population density of 1,500 inhabitants per km² of permanent land or a minimum 'optimal' built-up area threshold. In addition, the total population should be at least 50,000. Gaps in the urban centres are filled, and edges are smoothed with a 3 × 3 majority rule.

- **Urban clusters** are clusters of cells (queen contiguity) with a minimum population density of 300 inhabitants per km² of permanent land and a minimum total population of 5,000 inhabitants. Cells that belong to urban centres are removed from urban clusters.

- **Rural grid cells** do not belong to an urban centre or cluster.

In stage 2, statistical spatial units are classified into (1) cities, (2) towns and semi-dense areas, and (3) rural areas based on the proportion of population in the three grid classes. The parameters in the classification rules, such as the minimum population thresholds, were carefully deliberated, drawing upon insights from numerous experts, and validated in several meetings of the United Nations (United Nations Statistics Division, 2019). However, it is important to note that there is room for adjustments in these classification rules, as exemplified by the amended versions of DEGURBA in the most recent GHSL Data Packages.

The threefold classification described above is referred to as 'Level 1' of DEGURBA. The methodology also encompasses a 'Level 2' classification, which includes seven more detailed sub-classes. For more information about the Level 2 classification and the DEGURBA methodology more generally, readers can consult Dijkstra et al. (2021), the methodological manual (Eurostat, 2021), or the GHSL Data Packages (European Commission, 2023; Schiavina et al., 2022).

---

## The flexurba package

### Functionalities

The core of the flexurba package comprises functions to establish the grid cell classification (stage 1) and the spatial units classification (stage 2) of DEGURBA. The grid cell classification is implemented through the function classify_grid and offers customisable classification rules via its arguments. Code example 1 illustrates the code for four different parameterisations applied to the case of Belgium. First, Belgium's pre-processed population grid, built-up area grid, and land grid are loaded in the object data_belgium. Afterwards, the grid cell classification is constructed (A) with standard parameters, (B) with decreased population thresholds, (C) with queen contiguity for urban centres, and (D) without the built-up area criterium. The resulting classifications are visualised in Figure 1. Decreasing the population thresholds or changing the contiguity rule for urban centres results in more and larger urban centres (e.g. Aalst – a mid-sized city – becomes an urban centre), whereas removing the built-up area rule decreases the coverage of urban centres (e.g. the port of Antwerp is no longer part of an urban centre). Minor variations in the parameters thus lead to differences in the classification and may have substantial implications for policymaking and research that draw on DEGURBA.

**Code example 1: Grid classification for Belgium with 4 different parameterisations.**

```r
library(flexurba)
# get the required data
data_belgium <- load_grid_data_belgium()

# (A) with the standard parameters
classification_1 <- classify_grid(data_belgium)

# (B) with decreased population density and size thresholds
# for urban centres (UC) and urban clusters (UCL)
classification_2 <- classify_grid(data_belgium,
                        parameters = list(UC_density_threshold = 1000,
                                         UC_size_threshold = 30000,
                                         UCL_density_threshold = 200,
                                         UCL_size_threshold = 3000))

# (C) with queens contiguity (8-cell connectivity) for urban centres
classification_3 <- classify_grid(data_belgium,
                        parameters = list(UC_contiguity_rule = 8))

# (D) without the built-up area criterium for urban centres
classification_4 <- classify_grid(data_belgium,
                        parameters = list(UC_built_criterium = FALSE))
```

**Figure 1.** Result of the grid classification of Belgium constructed in Code example 1: (A) with standard parameters, (B) with density thresholds 1,000 and 200, and size thresholds 30,000 and 3,000 for urban centres and urban clusters, respectively, (C) with queen contiguity for urban centres, and (D) without the built-up area criterium for urban centres. All other parameters are kept constant according to the standard implementation of DEGURBA.

Code example 2 illustrates how spatial units can be classified with the function classify_units. The data object flexurba::data_units, containing GADM (2023) units for Belgium, is used to classify (A) Belgian municipalities and (B) Belgian districts ('arrondissementen'). The results are visualised in Figure 2 and reveal the effect of the Modifiable Areal Unit Problem (Openshaw, 1984). Bruges and Ghent are classified as a city on the municipal level, but their corresponding districts are not classified as cities.

**Code example 2: Unit classification for Belgium at two different levels.**

```r
library(flexurba)

# get the required data
data_belgium <- load_grid_data_belgium()
classification <- classify_grid(data_belgium)

# (A) spatial units classification at the finest GADM level (= Belgian municipalities)
units_1 <- preprocess_units(units = flexurba::units_belgium,
                           classification = classification,
                           pop = data_belgium$pop)
units_classification_1 <- classify_units(units_1)

# (B) spatial units classification at the GADM level 3 (= Belgian districts)
units_2 <- preprocess_units(units = flexurba::units_belgium,
                           classification = classification,
                           pop = data_belgium$pop,
                           dissolve_units_by = "GID_3")
units_classification_2 <- classify_units(units_2, id = "GID_3")
```

**Figure 2.** Result of the classification of spatial units in Belgium constructed in Code Example 2: (A) for Belgian municipalities and (B) Belgian districts.

The functions classify_grid and classify_units can also be used to construct the grid cell and spatial units classification of Level 2 of DEGURBA, respectively. In addition, the flexurba package provides several utility functions for downloading and pre-processing the necessary input data (the population, built-up area, and land grid) and plotting the results. In that way, researchers can conduct an entire workflow with the package, from acquiring the data to visualising the results. For an overview of all functions and their functionalities, we refer to the package documentation website.

### Comparison with the official grid classification

Despite our attempts to reconstruct the algorithm precisely, there are some minor discrepancies between the grid classification of flexurba and the SMOD layer of the GHSL (the settlement layer containing the official Level 2 grid classification; European Commission, 2023). Table 1 reports the difference on a global scale between (1) the Level 1 classification generated by the function classify_grid (with the default parameter settings) and (2) the Level 1 aggregation of the classes in the SMOD layer. Worldwide, there are 2,951 cells classified differently, these represent a mere 0.002% of the global land area. These discrepancies are likely caused by the three following issues.

**Table 1. Cross-tabular comparison of global zonal statistics (based on the number of 1 km² grid cells) between the Level 1 aggregation of the classes in the SMOD layer and the results of the flexurba Level 1 grid classification.**

|          | SMOD layer |              |               |               |             |
|----------|------------|--------------|---------------|---------------|-------------|
| Flexurba | Urban centre | Urban cluster | Rural cell | Water cell | Row total |
| Urban centre | **633,825** | 158 | 800 | 30 | 634,813 |
| Urban cluster | 8 | **2,516,336** | 119 | 0 | 2,516,463 |
| Rural cell | 20 | 1,812 | **142,836,918** | 0 | 142,838,750 |
| Water cell | 4 | 0 | 0 | **365,190,446** | 365,190,450 |
| Column total | 633,857 | 2,518,306 | 142,837,837 | 365,190,476 | |

The number in bold signify consistent classification between flexurba and the SMOD layer.

First, differences in coding languages and versions of software libraries can lead to minor inconsistencies in the resulting classification. Second, there might be some misinterpretation of the official DEGURBA documentation from our end. This, in some way, highlights the importance of openly sharing source code alongside verbatim documentation (Rey, 2009). By publicly releasing the flexurba package, we hope to resolve discrepancies caused by misinterpretation with the input of the geospatial community and/or feedback of the developers of the DEGURBA methodology. Third, there is a minor disparity between the Level 1 and Level 2 documentation in GHSL Data Package 2023, which is likely at the root of some differences in the flexurba Level 1 classification. This disparity is technically quite complex, so for a more detailed explanation, we refer to the vignette 'Comparison with GHSL SMOD Layer' on the package documentation website. Although the differences with the SMOD layer are relatively limited, the user should keep them in mind when employing the package.

### Technical details and computational requirements

The grid cell classification requires processing a large amount of data, especially when executed at a global scale (i.e. nearly 650 million cells). To tackle this issue, most of the functions in the flexurba package rely on terra, a well-established framework in R that can handle data files that are too large to load into memory (Hijmans et al., 2024). We have optimised the most time-consuming functions (e.g. the 3 × 3 majority rule) by writing them in fast C++ code (through Rcpp; Eddelbuettel et al., 2023) and ensuring efficient memory use for global grid classification by processing independent regions separately. However, the flexurba package is still slower and requires slightly more memory than existing tools (Global Human Settlement Layer, 2023). With standard parameter settings, it is thus advised to employ the existing GHSL tools. However, as the flexurba package offers enhanced flexibility, works across all major operating systems, integrates seamlessly into data science workflows, and allows users to tailor the methodology to their specific needs, it enables a broader range of analyses beyond DEGURBA's direct application.

---

## Potential applications

The Degree of Urbanisation methodology aims to provide a globally consistent delineation of urban areas (Dijkstra et al., 2021). However, it might be relevant for academic research to adapt the standard parameters in the algorithm, as different delineations may be more appropriate depending on the research question and geographical context (Duranton, 2021). For example, Henderson et al. (2021) investigate economic density in Sub-Saharan Africa and argue that the minimum density of 300 inhabitants per km² for urban clusters is too low. They propose a slightly increased threshold of 500 inhabitants and employ a 7 × 7 average smoothing filter instead of using the standard edge smoothing rule for urban centres. Urban delineations with these alternative classification rules can easily be constructed with the flexurba package.

Furthermore, the package allows for sensitivity analysis of minor implementation changes in DEGURBA's classification rules. The algorithm behind DEGURBA is often altered in the context of new GHSL Data Package releases. As an example, in GHSL Data Package 2022, DEGURBA included a fixed minimum built-up area threshold of 50% to account for the presence of office parks, shopping malls, factories, and transport infrastructure. Urban centres were created using cells with at least 1,500 inhabitants per km² and cells with at least 50% built-up area (Schiavina et al., 2022). In GHSL Data Package 2023, the built-up area rule is slightly adapted: a minimum 'optimal' built-up threshold is employed, instead of the minimum fixed threshold of 50% built-up area. This 'optimal' threshold, as defined in GHSL Data Package 2023, is dynamically identified as the average proportion of built-up area in clusters of cells with a density of at least 1,500 inhabitants per km² and at least a total population of 5,000 (European Commission, 2023). Based on this official definition of the 'optimal' built-up threshold, using the flexurba package, we calculated that the global threshold for the GHSL data of 2020 is 20% built-up area. This means that both cells with at least 1,500 inhabitants per km² and cells with at least 20% built-up area are considered when identifying urban centres. Changing the built-up area rule from a fixed to an 'optimal' threshold thus implied a decrease from 50% built-up area to 20% built-up area, which caused a substantial increase in the coverage of urban centres. The flexurba package facilitates uncovering the implications of such implementation changes and thus allows performing (potentially spatially explicit) sensitivity analyses.

---

## Conclusion

In this paper, we presented flexurba, an open software product built on well-established spatial frameworks in R. The source code of flexurba is published under a separate doi and can be freely explored and downloaded from this git repository. We hope to continue expanding and improving the package based on future requests, potential bug fixes, and contributions from the authors and the community. By sharing the first open reconstruction of the Degree of Urbanisation algorithm, we invite researchers to explore the possibilities of related urban delineations and repurpose the DEGURBA methodology from its original application to a broad range of related urban analyses.

---

## Acknowledgements

We would like to acknowledge the developers of the Degree of Urbanisation and the team behind the Global Human Settlement Layer for providing such a comprehensive and clear documentation of the DEGURBA methodology and the large set of valuable open data sources.

## Declaration of conflicting interests

The author(s) declared no potential conflicts of interest with respect to the research, authorship, and/or publication of this article.

## Funding

The author(s) disclosed receipt of the following financial support for the research, authorship, and/or publication of this article: The research for this paper was supported by Research Foundation Flanders (FWO) under PhD project number 11P4224N, by Patronage Funding Provided to KU Leuven for Carrying Out Scientific Research Into Urban Processes and Change, and Partly by Internal Funds KU Leuven grant number STG/20/021.

## ORCID iDs

Céline Van Migerode https://orcid.org/0000-0002-4023-7665
Ate Poorthuis https://orcid.org/0000-0002-3808-7493
Ben Derudder https://orcid.org/0000-0001-6195-8544

## Data availability statement

The flexurba package is published under the following doi: https://doi.org/10.48804/FMJEVT. The source code can be explored and downloaded from: https://gitlab.kuleuven.be/spatial-networks-lab/research-projects/flexurba. The documentation of the package's functions and several examples are included on the following website: https://flexurba-spatial-networks-lab-research-projects–e74426d1c66ecc.pages.gitlab.kuleuven.be.

## Notes

1. This minimum 'optimal' built-up area threshold, as defined in GHSL Data Package 2023, is determined as the average built-up density in clusters of cells (rooks contiguity) with at least 1,500 inhabitants per km² of permanent land and a minimum total population of 50,000 inhabitants (for more information: see GHSL Data Package, 2023, footnote 30 on page 51).
2. More information on how to use the package for Level 2 is provided in the vignette 'Level 2 of the Degree of Urbanisation' on the package documentation website.
3. See the vignette 'Computational requirements' on the package documentation website.
4. More specifically with the parameters UCL_density_threshold = 500, UC_smooth_edge = FALSE, UC_smooth_pop = TRUE and UC_smooth_pop_window = 7 in the function classify_grid.
5. For the derivation of the 'optimal' built-up area proportion: see the vignette 'Comparison between Data Package 2022 and 2023' on the package documentation website.

---

## References

Boeing G (2020) The right tools for the job: the case for spatial science tool-building. Transactions in GIS 24(5): 1299–1314. DOI: 10.1111/tgis.12678.

Dijkstra L, Florczyk AJ, Freire S, et al. (2021) Applying the degree of urbanisation to the globe: a new harmonised definition reveals a different picture of global urbanisation. Journal of Urban Economics 125(103312): 103312. DOI: 10.1016/j.jue.2020.103312.

Dorward N and Fox S (2022) Population pressure, political institutions, and protests: a multilevel analysis of protest events in African cities. Political Geography 99(102762): 102762. DOI: 10.1016/j.polgeo.2022.102762.

Duranton G (2021) Classifying locations and delineating space: an introduction. Journal of Urban Economics 125(103353): 103353. DOI: 10.1016/j.jue.2021.103353.

Eddelbuettel D, Francois R, Allaire JJ, et al. (2023) Rcpp: seamless R and C++ integration. Journal of Statistical Software 40(8): 1–18. https://cran.r-project.org/web/packages/Rcpp/index.html

European Commission (2023) Publications office of the European union. GHSL Data Package 2023: JRC133256. https://ghsl.jrc.ec.europa.eu/documents/GHSL_Data_Package_2023.pdf

Eurostat (2016) Urban Europe—Statistics on Cities, Towns and Suburbs. Luxembourg: Eurostat. https://ec.europa.eu/eurostat/web/products-statistical-books/-/ks-01-16-691

Eurostat (2021) Applying the Degree of Urbanisation—A Methodological Manual to Define Cities, Towns and Rural Areas for International Comparisons—2021 Edition. Luxembourg: Eurostat. https://ec.europa.eu/eurostat/web/products-manuals-and-guidelines/-/ks-02-20-499

GADM (2023) GADM Database of Global Administrative Areas [Dataset]. Dorchester: GADM. https://gadm.org

Global Human Settlement Layer (2023) GHSL Tools: Degree of Urbanisation, Population and Settlement Analysis [Computer Software]. Rome: Global Human Settlement Layer. https://ghsl.jrc.ec.europa.eu/tools.php

Henderson JV, Nigmatulina D and Kriticos S (2021) Measuring urban economic density. Journal of Urban Economics 125(103188): 103188. DOI: 10.1016/j.jue.2019.103188

Hijmans R, Bivand R, Emanuele C, Dyba K, Pebesma E, Sumner M, et al. (2024) Terra: Spatial Data Analysis. R package version 1.7-79. [Computer Software]. Available at: https://rspatial.github.io/terra/

Melchiorri M, Pesaresi M, Florczyk AJ, et al. (2019) Principles and applications of the global human settlement layer as baseline for the land use efficiency indicator—SDG 11.3.1. ISPRS International Journal of Geo-Information 8: 96. DOI: 10.3390/ijgi8020096

Moreno-Monroy AI, Schiavina M and Veneri P (2021) Metropolitan areas in the world. Delineation and population trends. Journal of Urban Economics 125(103242): 103242. DOI: 10.1016/j.jue.2020.103242

OECD (2020) Cities in the World: A New Perspective on Urbanisation. Paris: Organisation for Economic Co-Operation and Development. https://www.oecd-ilibrary.org/urban-rural-and-regional-development/cities-in-the-world_d0efcbda-en

Openshaw S (1984) The Modifiable Areal Unit Problem. Norwich: GeoBooks.

Rey SJ (2009) Show me the code: spatial analysis and open source. Journal of Geographical Systems 11(2): 191–207. DOI: 10.1007/s10109-009-0086-8

Schiavina M, Melchiorri M, Pesaresi M, et al. (2022) Publications office of the European union. GHSL Data Package 2022: JRC129516. https://ghsl.jrc.ec.europa.eu/documents/GHSL_Data_Package_2022.pdf

Thornton JM, Snethlage MA, Sayre R, et al. (2022) Human populations in the world's mountains: spatio-temporal patterns and potential controls. PLoS One 17(7): e0271466. DOI: 10.1371/journal.pone.0271466

United Nations Statistics Division (2019) United Nations Expert Group Meeting on Statistical Methodology for Delineating Cities and Rural Areas. New York, NY: United Nations Statistics Division. https://unstats.un.org/unsd/demographic-social/meetings/2019/newyork-egm-statmeth.cshtml

---

## Author Biographies

**Céline Van Migerode** is PhD researcher of the Research Foundation Flanders (FWO). Her current research focuses on the inconsistency and variability inherent to defining and operationalising 'the urban'. She employs quantitative data analytics to investigate which regions and types of urbanisation patterns across the world are most sensitive to changing an urban definition to understand whether definitions incorporate specific assumptions about 'the urban' and what are the potential implications of these for policymaking and knowledge production in the field of urban studies.

**Ate Poorthuis** is an Assistant Professor in Big Data and Human-Environment Systems at the KU Leuven Division of Geography and Tourism. His research explores the possibilities and limitations of big data, through quantitative analysis and visualization, to better understand how cities work.

**Ben Derudder** is a Professor in Urban Studies at the KU Leuven Public Governance Institute and Director of the KU Leuven Urban Studies Institute. His research adopts an explicitly spatial approach to studying urban and regional questions: city networks at the global scale, urban and regional polycentricity, the transformation of Chinese urban regions, and region-formation in Flanders.
